#!/bin/bash
cd /opt/ixpcontrol/data/routeserver/PEERS;
rm -rf /opt/ixpcontrol/data/routeserver/PREFIX/prefixes_v4.conf;
rm -rf /opt/ixpcontrol/data/routeserver/PREFIX/prefixes_v6.conf;
echo "IPv4 Generation"
for v4ASN in *; do
    if [ -d "$v4ASN" ]; then
                echo "Found ASN: $v4ASN"
                if [[ -e /opt/ixpcontrol/data/routeserver/PEERS/$v4ASN/prefix_v4.conf ]]; then
                        tail -n +2 /opt/ixpcontrol/data/routeserver/PEERS/$v4ASN/prefix_v4.conf  | head -n-1 | sed 's/,//g' | sed 's/    //g' >> /opt/ixpcontrol/data/routeserver/PREFIX/prefixes_v4.conf

                fi
    fi
done
echo "IPv6 Generation"
for v6ASN in *; do
    if [ -d "$v6ASN" ]; then
                echo "Found ASN: $v6ASN"
                if [[ -e /opt/ixpcontrol/data/routeserver/PEERS/$v6ASN/prefix_v6.conf ]]; then
                        tail -n +2 /opt/ixpcontrol/data/routeserver/PEERS/$v6ASN/prefix_v6.conf  | head -n-1 | sed 's/,//g' | sed 's/    //g' >> /opt/ixpcontrol/data/routeserver/PREFIX/prefixes_v6.conf

                fi
    fi
done
